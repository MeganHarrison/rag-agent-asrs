<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FM Global 8-34 ASRS Sprinkler Design System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #0066cc;
            --secondary: #f8f9fa;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --dark: #343a40;
            --light: #f8f9fa;
            --border: #dee2e6;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--primary), #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .header p {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 20px;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary);
            display: block;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }
        
        .form-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        .form-section h2 {
            color: var(--primary);
            margin-bottom: 20px;
            font-size: 1.8rem;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1);
        }
        
        .btn {
            background: linear-gradient(135deg, var(--primary), #0052a3);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-block;
            text-decoration: none;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 102, 204, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--success), #1e7e34);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #d39e00);
            color: #333;
        }
        
        .results {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-top: 30px;
            display: none;
        }
        
        .requirements-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .requirements-table th,
        .requirements-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        
        .requirements-table th {
            background: var(--secondary);
            font-weight: 600;
        }
        
        .optimization {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }
        
        .optimization h4 {
            color: #0c5460;
            margin-bottom: 10px;
        }
        
        .savings {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--success);
        }
        
        .progress-bar {
            background: #e9ecef;
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--success));
            border-radius: 10px;
            transition: width 0.8s ease;
        }
        
        .upload-zone {
            border: 2px dashed var(--border);
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .upload-zone:hover {
            border-color: var(--primary);
            background: rgba(0, 102, 204, 0.05);
        }
        
        .upload-zone.dragover {
            border-color: var(--primary);
            background: rgba(0, 102, 204, 0.1);
        }
        
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üè≠ ASRS Sprinkler Design System</h1>
            <p>FM Global 8-34 Compliance Made Simple - Powered by AI</p>
            <div class="stats">
                <div class="stat-card">
                    <span class="stat-number">47</span>
                    <span class="stat-label">Protection Tables Analyzed</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">95%</span>
                    <span class="stat-label">Time Savings</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">$2M+</span>
                    <span class="stat-label">Avg Cost Optimization</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">1536D</span>
                    <span class="stat-label">AI Vector Dimensions</span>
                </div>
            </div>
        </div>

        <!-- System Configuration Form -->
        <div class="form-section">
            <h2>üìã System Configuration</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label for="asrs-type">ASRS System Type *</label>
                    <select id="asrs-type" required onchange="updateForm()">
                        <option value="">Select ASRS Type</option>
                        <option value="shuttle">Shuttle ASRS (Direct storage on rails)</option>
                        <option value="mini-load">Mini-Load ASRS (Angle iron guides, 2ft spacing)</option>
                        <option value="top-loading">Top-Loading ASRS (Robot access from above)</option>
                        <option value="vertically-enclosed">Vertically Enclosed ASRS (Carousel/lift)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="rack-height">Maximum Rack Height (ft) *</label>
                    <input type="number" id="rack-height" min="8" max="120" required onchange="calculateRequirements()">
                </div>
                
                <div class="form-group">
                    <label for="container-type">Container Configuration *</label>
                    <select id="container-type" required onchange="updateCostImpact()">
                        <option value="">Select Container Type</option>
                        <option value="closed-noncombustible">Closed Non-combustible (Metal)</option>
                        <option value="closed-combustible">Closed Combustible</option>
                        <option value="open-noncombustible">Open-Top Non-combustible</option>
                        <option value="open-combustible">Open-Top Combustible ‚ö†Ô∏è High Cost</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="commodity-class">Commodity Classification *</label>
                    <select id="commodity-class" required>
                        <option value="">Select Commodity Class</option>
                        <option value="class-1">Class 1 (Low hazard)</option>
                        <option value="class-2">Class 2 (Moderate hazard)</option>
                        <option value="class-3">Class 3 (High hazard)</option>
                        <option value="class-4">Class 4 (Very high hazard)</option>
                        <option value="plastic">Plastic Commodities</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="system-type">System Type *</label>
                    <select id="system-type" required onchange="updateSprinklerCount()">
                        <option value="">Select System Type</option>
                        <option value="wet">Wet System (Recommended)</option>
                        <option value="dry">Dry System (Cold environments)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="ceiling-height">Ceiling Height (ft) *</label>
                    <input type="number" id="ceiling-height" min="20" max="60" required>
                </div>
            </div>
        </div>

        <!-- Advanced Parameters -->
        <div class="form-section">
            <h2>‚öôÔ∏è Advanced Parameters</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label for="aisle-width">Aisle Width (ft)</label>
                    <input type="number" id="aisle-width" min="3" max="12" step="0.5" value="6">
                </div>
                
                <div class="form-group">
                    <label for="upright-spacing">Upright Spacing (ft)</label>
                    <input type="number" id="upright-spacing" min="1.5" max="4" step="0.5" value="2">
                </div>
                
                <div class="form-group">
                    <label for="building-area">Building Area (sq ft)</label>
                    <input type="number" id="building-area" min="10000" max="1000000">
                </div>
                
                <div class="form-group">
                    <label for="water-pressure">Available Water Pressure (psi)</label>
                    <input type="number" id="water-pressure" min="30" max="150" value="60">
                </div>
            </div>
        </div>

        <!-- File Upload for Vectorization -->
        <div class="form-section">
            <h2>üìÑ Document Vectorization (Optional)</h2>
            <div class="upload-zone" id="upload-zone">
                <p>üìé Drop your ASRS drawings, specifications, or FM Global documents here</p>
                <p>Supports: PDF, DWG, images - Files will be vectorized for intelligent search</p>
                <input type="file" id="file-upload" multiple accept=".pdf,.dwg,.png,.jpg,.jpeg" style="display: none;">
                <button class="btn" onclick="document.getElementById('file-upload').click()">Browse Files</button>
            </div>
            <div id="upload-progress" style="display: none;">
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                <p id="upload-status">Vectorizing documents...</p>
            </div>
        </div>

        <!-- Calculate Button -->
        <div style="text-align: center; margin: 30px 0;">
            <button class="btn" onclick="generateRequirements()" id="calculate-btn" disabled>
                üöÄ Generate Requirements & Find Optimizations
            </button>
        </div>

        <!-- Results Section -->
        <div class="results" id="results">
            <h2>üìä Design Requirements & Optimization</h2>
            
            <!-- Requirements Table -->
            <table class="requirements-table">
                <thead>
                    <tr>
                        <th>Parameter</th>
                        <th>Requirement</th>
                        <th>FM Table Reference</th>
                        <th>Notes</th>
                    </tr>
                </thead>
                <tbody id="requirements-body">
                    <!-- Dynamic content will be inserted here -->
                </tbody>
            </table>

            <!-- Cost Optimization -->
            <div class="optimization">
                <h4>üí° Cost Optimization Opportunities</h4>
                <div id="optimization-content">
                    <!-- Dynamic optimization suggestions -->
                </div>
                <div class="savings" id="potential-savings">Potential Savings: Calculating...</div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentConfig = {};
        let vectorizedDocuments = [];
        
        // Form validation and updates
        function updateForm() {
            const asrsType = document.getElementById('asrs-type').value;
            const calculateBtn = document.getElementById('calculate-btn');
            
            // Enable/disable calculate button based on required fields
            const requiredFields = ['asrs-type', 'rack-height', 'container-type', 'commodity-class', 'system-type', 'ceiling-height'];
            const allFilled = requiredFields.every(field => document.getElementById(field).value !== '');
            
            calculateBtn.disabled = !allFilled;
            calculateBtn.style.opacity = allFilled ? '1' : '0.5';
        }

        // Cost impact visualization
        function updateCostImpact() {
            const containerType = document.getElementById('container-type').value;
            const systemType = document.getElementById('system-type').value;
            
            // Visual feedback for high-cost configurations
            if (containerType === 'open-combustible') {
                document.getElementById('container-type').style.borderColor = '#dc3545';
                document.getElementById('container-type').style.backgroundColor = '#f8d7da';
            } else {
                document.getElementById('container-type').style.borderColor = '#dee2e6';
                document.getElementById('container-type').style.backgroundColor = 'white';
            }
        }

        // Real-time requirement calculation
        function calculateRequirements() {
            const height = parseInt(document.getElementById('rack-height').value);
            const ceilingHeight = parseInt(document.getElementById('ceiling-height').value);
            
            // Visual feedback for challenging configurations
            if (height > 40) {
                document.getElementById('rack-height').style.borderColor = '#ffc107';
            } else {
                document.getElementById('rack-height').style.borderColor = '#28a745';
            }
        }

        // File upload handling with vectorization simulation
        function setupFileUpload() {
            const uploadZone = document.getElementById('upload-zone');
            const fileInput = document.getElementById('file-upload');
            
            // Drag and drop handlers
            uploadZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadZone.classList.add('dragover');
            });
            
            uploadZone.addEventListener('dragleave', () => {
                uploadZone.classList.remove('dragover');
            });
            
            uploadZone.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadZone.classList.remove('dragover');
                const files = e.dataTransfer.files;
                processFiles(files);
            });
            
            fileInput.addEventListener('change', (e) => {
                processFiles(e.target.files);
            });
        }

        // Process uploaded files with vectorization
        async function processFiles(files) {
            const progressContainer = document.getElementById('upload-progress');
            const progressFill = document.getElementById('progress-fill');
            const statusText = document.getElementById('upload-status');
            
            progressContainer.style.display = 'block';
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const progress = ((i + 1) / files.length) * 100;
                
                progressFill.style.width = progress + '%';
                statusText.textContent = `Vectorizing ${file.name}... (${i + 1}/${files.length})`;
                
                // Simulate vectorization process
                await simulateVectorization(file);
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
            
            statusText.textContent = `‚úÖ Successfully vectorized ${files.length} documents`;
            progressFill.style.width = '100%';
        }

        // Simulate document vectorization
        async function simulateVectorization(file) {
            // This would call the actual Cloudflare Worker endpoint
            const mockVector = {
                filename: file.name,
                size: file.size,
                dimensions: 1536,
                semantic_features: generateMockEmbedding(),
                extracted_text: 'Mock extracted content...',
                detected_tables: Math.floor(Math.random() * 10) + 1,
                figures_found: Math.floor(Math.random() * 5) + 1
            };
            
            vectorizedDocuments.push(mockVector);
            return mockVector;
        }

        // Generate mock embedding for demonstration
        function generateMockEmbedding() {
            return Array.from({length: 1536}, () => Math.random() * 2 - 1);
        }

        // Main requirement generation function
        async function generateRequirements() {
            const resultsDiv = document.getElementById('results');
            const requirementsBody = document.getElementById('requirements-body');
            const optimizationContent = document.getElementById('optimization-content');
            const potentialSavings = document.getElementById('potential-savings');
            
            // Collect form data
            currentConfig = {
                asrsType: document.getElementById('asrs-type').value,
                rackHeight: parseInt(document.getElementById('rack-height').value),
                containerType: document.getElementById('container-type').value,
                commodityClass: document.getElementById('commodity-class').value,
                systemType: document.getElementById('system-type').value,
                ceilingHeight: parseInt(document.getElementById('ceiling-height').value),
                aisleWidth: parseFloat(document.getElementById('aisle-width').value),
                uprightSpacing: parseFloat(document.getElementById('upright-spacing').value),
                buildingArea: parseInt(document.getElementById('building-area').value),
                waterPressure: parseInt(document.getElementById('water-pressure').value)
            };
            
            // Show results
            resultsDiv.style.display = 'block';
            
            // Generate requirements based on FM Global tables
            const requirements = await calculateFMGlobalRequirements(currentConfig);
            
            // Populate requirements table
            requirementsBody.innerHTML = requirements.map(req => `
                <tr>
                    <td><strong>${req.parameter}</strong></td>
                    <td>${req.value}</td>
                    <td><a href="#table-${req.tableRef}" style="color: var(--primary);">${req.tableRef}</a></td>
                    <td>${req.notes}</td>
                </tr>
            `).join('');
            
            // Generate optimizations
            const optimizations = await findOptimizations(currentConfig);
            optimizationContent.innerHTML = optimizations.map(opt => `
                <div style="margin: 10px 0; padding: 10px; background: rgba(40, 167, 69, 0.1); border-left: 4px solid #28a745; border-radius: 4px;">
                    <strong>${opt.title}</strong><br>
                    ${opt.description}<br>
                    <span style="color: #28a745; font-weight: bold;">Potential Savings: ${opt.savings}</span>
                </div>
            `).join('');
            
            // Calculate total potential savings
            const totalSavings = optimizations.reduce((sum, opt) => sum + opt.savingsAmount, 0);
            potentialSavings.textContent = `Potential Savings: $${totalSavings.toLocaleString()}`;
        }

        // FM Global table lookup engine (simplified)
        async function calculateFMGlobalRequirements(config) {
            // This would interface with the actual Cloudflare Worker
            const mockRequirements = [
                {
                    parameter: 'Ceiling Sprinkler Density',
                    value: '0.30 gpm/sq ft over 2000 sq ft',
                    tableRef: 'Table 4',
                    notes: 'Wet system, closed containers'
                },
                {
                    parameter: 'Sprinkler K-Factor',
                    value: '16.8 (242 metric)',
                    tableRef: 'Table 4',
                    notes: 'Quick response preferred'
                },
                {
                    parameter: 'Water Supply Pressure',
                    value: '50 psi minimum',
                    tableRef: 'Section 2.4.1',
                    notes: 'At most remote sprinkler'
                },
                {
                    parameter: 'In-Rack Protection',
                    value: config.containerType.includes('open') ? 'Required' : 'Not Required',
                    tableRef: config.containerType.includes('open') ? 'Table 39' : 'N/A',
                    notes: config.containerType.includes('open') ? 'Vertical arrangement every tier' : 'Ceiling-only sufficient'
                }
            ];
            
            return mockRequirements;
        }

        // Cost optimization engine
        async function findOptimizations(config) {
            const optimizations = [];
            
            // Container type optimization
            if (config.containerType === 'open-combustible') {
                optimizations.push({
                    title: 'Container Modification Opportunity',
                    description: 'Consider using closed-top containers or metal lids to eliminate in-rack sprinkler requirements',
                    savings: '$180,000 - $450,000',
                    savingsAmount: 315000
                });
            }
            
            // Rack spacing optimization
            if (config.uprightSpacing < 2.5) {
                optimizations.push({
                    title: 'Upright Spacing Optimization',
                    description: 'Increasing upright spacing to 2.5ft could reduce sprinkler density requirements',
                    savings: '$25,000 - $75,000',
                    savingsAmount: 50000
                });
            }
            
            // Height optimization
            if (config.rackHeight > 40) {
                optimizations.push({
                    title: 'Storage Height Consideration',
                    description: 'Reducing maximum storage height to 40ft eliminates enhanced protection requirements',
                    savings: '$100,000 - $200,000',
                    savingsAmount: 150000
                });
            }
            
            return optimizations;
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            setupFileUpload();
            
            // Add event listeners to all form inputs
            const inputs = document.querySelectorAll('input, select');
            inputs.forEach(input => {
                input.addEventListener('change', updateForm);
            });
        });
    </script>
</body>
</html>